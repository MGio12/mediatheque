================================================================================
                    RAPPORT COMPLET DU PROJET MEDIATHEQUE
                    E-Library - Systeme de Gestion de Mediatheque
================================================================================

================================================================================
                        1. STRUCTURE DU PROJET
================================================================================

mediatheque/
|
|-- app/                          # Coeur de l'application
|   |-- controllers/              # 10 Controleurs
|   |   |-- HomeController.php        -> Page d'accueil
|   |   |-- AuthController.php        -> Authentification (login/register/logout)
|   |   |-- CatalogueController.php   -> Navigation du catalogue
|   |   |-- RessourceController.php   -> Affichage detail ressources
|   |   |-- EvaluationController.php  -> Gestion des notes/avis
|   |   |-- AdminController.php       -> Dashboard administrateur
|   |   |-- LivreController.php       -> CRUD des livres
|   |   |-- FilmController.php        -> CRUD des films
|   |   |-- GenreController.php       -> CRUD des genres
|   |   |-- ThemeController.php       -> CRUD des themes
|   |
|   |-- models/                   # 7 Modeles (POO avec heritage)
|   |   |-- Utilisateur.php           -> Gestion des utilisateurs
|   |   |-- Ressource.php             -> Classe parente (livres/films)
|   |   |-- Livre.php                 -> Modele specifique livres
|   |   |-- Film.php                  -> Modele specifique films
|   |   |-- Evaluation.php            -> Modele des evaluations
|   |   |-- Genre.php                 -> Modele des genres
|   |   |-- Theme.php                 -> Modele des themes
|   |
|   |-- views/                    # 26 Templates PHP
|       |-- layout.php                -> Template principal (header/footer)
|       |-- partials/
|       |   |-- header.php            -> En-tete du site
|       |   |-- footer.php            -> Pied de page
|       |-- home/
|       |   |-- index.php             -> Page d'accueil
|       |-- auth/
|       |   |-- login.php             -> Formulaire connexion
|       |   |-- register.php          -> Formulaire inscription
|       |-- catalogue/
|       |   |-- index.php             -> Liste du catalogue
|       |   |-- nouveautes.php        -> Nouveautes
|       |   |-- top.php               -> Top notes
|       |   |-- selection.php         -> Selection par theme
|       |   |-- search.php            -> Recherche avancee
|       |-- ressource/
|       |   |-- show.php              -> Detail d'une ressource
|       |-- admin/
|           |-- index.php             -> Dashboard admin
|           |-- livre/                -> CRUD livres (index, create, edit)
|           |-- film/                 -> CRUD films (index, create, edit)
|           |-- genre/                -> CRUD genres (index, create, edit)
|           |-- theme/                -> CRUD themes (index, create, edit)
|
|-- core/                         # Framework maison (5 fichiers)
|   |-- Router.php                    -> Routage des URLs
|   |-- Controller.php                -> Classe de base controleurs
|   |-- Model.php                     -> Classe de base modeles
|   |-- Database.php                  -> Connexion PDO (singleton)
|   |-- Auth.php                      -> Gestion authentification/roles
|
|-- config/
|   |-- config.php                    -> Configuration BDD (dev/prod)
|
|-- public/                       # Fichiers statiques
|   |-- css/
|   |   |-- style.css                 -> Styles CSS (1200+ lignes, themes)
|   |-- img/
|   |   |-- livres/                   -> 21 images de couvertures livres
|   |   |-- films/                    -> 22 images de couvertures films
|   |   |-- placeholders/             -> Image placeholder
|   |   |-- hero-christmas.png        -> Image hero
|   |-- js/                           -> (JavaScript inline dans les vues)
|
|-- sql/                          # Base de donnees
|   |-- schema.sql                    -> Structure complete BDD
|   |-- data.sql                      -> Donnees d'exemple
|
|-- documentation/                # Documentation projet
|-- index.php                     # Point d'entree principal
|-- README.md                     # Guide d'installation


================================================================================
                        2. ARCHITECTURE TECHNIQUE
================================================================================

PATTERN MVC (Model-View-Controller)
-----------------------------------
- Modeles    : Acces aux donnees via PDO avec heritage de classes
- Vues       : Templates PHP avec systeme de layout
- Controleurs: Logique metier et traitement des requetes

FRAMEWORK MAISON
----------------
- Router.php     : Routage simple via parametres GET (?controller=X&action=Y)
- Controller.php : Classe de base avec methodes render() et renderWithoutLayout()
- Model.php      : Classe abstraite pour les operations CRUD
- Database.php   : Singleton pour la connexion PDO
- Auth.php       : Gestion des sessions et controle d'acces par role

STRUCTURE DES URLs
------------------
Format: index.php?controller=NOM&action=ACTION&id=ID

Exemples:
  - Page d'accueil     : ?controller=home&action=index
  - Catalogue          : ?controller=catalogue&action=index
  - Detail ressource   : ?controller=ressource&action=show&id=1
  - Connexion          : ?controller=auth&action=login
  - Admin dashboard    : ?controller=admin&action=index
  - Creer un livre     : ?controller=livre&action=create


================================================================================
                        3. BASE DE DONNEES (9 TABLES)
================================================================================

TABLE: utilisateur
------------------
  - id_utilisateur    INT (PK, AUTO_INCREMENT)
  - nom               VARCHAR(100) NOT NULL
  - prenom            VARCHAR(100) NOT NULL
  - email             VARCHAR(255) NOT NULL UNIQUE
  - mot_de_passe      VARCHAR(255) NOT NULL (bcrypt)
  - role              ENUM('administrateur', 'bibliothecaire', 'utilisateur')
  - date_inscription  DATETIME

TABLE: ressource (table parente)
--------------------------------
  - id_ressource        INT (PK, AUTO_INCREMENT)
  - type                ENUM('livre', 'film') NOT NULL
  - titre               VARCHAR(255) NOT NULL
  - auteur_realisateur  VARCHAR(255) NOT NULL
  - annee               INT NOT NULL
  - resume              TEXT
  - image_url           VARCHAR(500)
  - pays                VARCHAR(100)
  - date_ajout          DATETIME

TABLE: livre (herite de ressource)
----------------------------------
  - id_ressource    INT (PK, FK -> ressource)
  - isbn            VARCHAR(13) UNIQUE
  - editeur         VARCHAR(255)
  - nombre_pages    INT
  - prix            DECIMAL(10,2)
  - langue          VARCHAR(50)

TABLE: film (herite de ressource)
---------------------------------
  - id_ressource    INT (PK, FK -> ressource)
  - duree           INT (minutes)
  - support         ENUM('DVD', 'Blu-ray', 'Streaming')
  - langue          VARCHAR(50)
  - sous_titres     VARCHAR(255)
  - propose_par     VARCHAR(255)
  - casting         TEXT

TABLE: genre
------------
  - id_genre    INT (PK, AUTO_INCREMENT)
  - nom         VARCHAR(100) NOT NULL UNIQUE

TABLE: theme
------------
  - id_theme    INT (PK, AUTO_INCREMENT)
  - nom         VARCHAR(100) NOT NULL UNIQUE

TABLE: ressource_genre (N:N)
----------------------------
  - id_ressource    INT (FK -> ressource)
  - id_genre        INT (FK -> genre)
  - PRIMARY KEY (id_ressource, id_genre)

TABLE: ressource_theme (N:N)
----------------------------
  - id_ressource    INT (PK, FK -> ressource)
  - id_theme        INT (PK, FK -> theme)
  - PRIMARY KEY (id_ressource, id_theme)

TABLE: evaluation
-----------------
  - id_evaluation     INT (PK, AUTO_INCREMENT)
  - id_utilisateur    INT (FK -> utilisateur)
  - id_ressource      INT (FK -> ressource)
  - note              DECIMAL(2,1) CHECK (0.0 - 5.0)
  - critique          TEXT (max 1000 caracteres)
  - date_evaluation   DATETIME
  - UNIQUE (id_utilisateur, id_ressource) -> 1 avis par utilisateur par ressource


================================================================================
                        4. SYSTEME D'AUTHENTIFICATION
================================================================================

ROLES UTILISATEURS (3 niveaux)
------------------------------

1. UTILISATEUR (role par defaut)
   - Consulter le catalogue
   - Voir les details des ressources
   - Noter et evaluer les ressources
   - Ecrire des critiques

2. BIBLIOTHECAIRE
   - Toutes les permissions utilisateur
   - Gerer les livres (CRUD)
   - Gerer les films (CRUD)
   - Gerer les genres (CRUD)
   - Gerer les themes (CRUD)
   - Acceder au dashboard admin

3. ADMINISTRATEUR
   - Toutes les permissions bibliothecaire
   - Supprimer les evaluations/avis de la communaute
   - Moderation complete

COMPTES DE TEST
---------------
  Admin      : admin@mediatheque.com     / password123
  Biblio     : biblio@mediatheque.com    / password123
  Utilisateur: user@mediatheque.com      / password123

SECURITE AUTHENTIFICATION
-------------------------
  - Mots de passe haches avec bcrypt (password_hash)
  - Sessions PHP pour maintenir la connexion
  - Verification via password_verify()
  - Controle d'acces par role sur chaque action sensible


================================================================================
                        5. FONCTIONNALITES DETAILLEES
================================================================================

-------------------------------------------------------------------------------
                           FONCTIONNALITES PUBLIQUES
-------------------------------------------------------------------------------

PAGE D'ACCUEIL
--------------
  URL: ?controller=home&action=index (ou index.php)

  Contenu affiche:
    - Section "Nouveautes" : 8 dernieres ressources ajoutees
    - Section "Top Notes"  : 8 ressources les mieux notees
    - Menu de navigation par theme
    - Section "Derniers avis de la communaute" : 5 derniers avis

CATALOGUE GENERAL
-----------------
  URL: ?controller=catalogue&action=index

  Fonctionnalites:
    - Affichage de toutes les ressources (livres et films)
    - Note moyenne affichee avec etoiles
    - Nombre d'evaluations par ressource
    - Badges de type (Livre/Film)
    - Liste des genres pour chaque ressource

PAGE NOUVEAUTES
---------------
  URL: ?controller=catalogue&action=nouveautes

  Fonctionnalites:
    - 20 dernieres ressources ajoutees
    - Tri par date d'ajout (plus recent en premier)
    - Filtrage possible

PAGE TOP NOTES
--------------
  URL: ?controller=catalogue&action=top

  Fonctionnalites:
    - Ressources triees par note moyenne decroissante
    - Minimum 1 evaluation requise pour apparaitre
    - Affichage de la note et du nombre d'avis

SELECTION PAR THEME
-------------------
  URL: ?controller=catalogue&action=selection&theme=ID

  Fonctionnalites:
    - Filtrage des ressources par theme specifique
    - Affichage du nom du theme selectionne
    - Liste des ressources associees

RECHERCHE AVANCEE
-----------------
  URL: ?controller=catalogue&action=search

  Criteres de recherche:
    - Mot-cle (recherche dans titre, auteur, resume)
    - Type (livre ou film)
    - Genre
    - Theme
    - Annee (plage de dates)

  Resultats:
    - Liste des ressources correspondantes
    - Affichage des criteres appliques

DETAIL D'UNE RESSOURCE
----------------------
  URL: ?controller=ressource&action=show&id=ID

  Informations affichees:

  Pour tous:
    - Titre, auteur/realisateur, annee
    - Image de couverture
    - Resume complet
    - Pays d'origine
    - Genres associes (badges cliquables)
    - Themes associes (badges cliquables)
    - Note moyenne avec etoiles
    - Liste des evaluations de la communaute

  Pour les LIVRES specifiquement:
    - ISBN
    - Editeur
    - Nombre de pages
    - Prix
    - Langue

  Pour les FILMS specifiquement:
    - Duree (en minutes)
    - Support (DVD, Blu-ray, Streaming)
    - Langue
    - Sous-titres disponibles
    - Propose par
    - Casting

-------------------------------------------------------------------------------
                        FONCTIONNALITES AUTHENTIFIEES
-------------------------------------------------------------------------------

INSCRIPTION
-----------
  URL: ?controller=auth&action=register

  Champs requis:
    - Nom
    - Prenom
    - Email (unique)
    - Mot de passe (min 8 caracteres)
    - Confirmation mot de passe

  Validations:
    - Email au format valide
    - Email non deja utilise
    - Mots de passe identiques
    - Longueur minimale respectee

CONNEXION
---------
  URL: ?controller=auth&action=login

  Champs:
    - Email
    - Mot de passe

  Comportement:
    - Verification des identifiants
    - Creation de session
    - Redirection vers page d'accueil

DECONNEXION
-----------
  URL: ?controller=auth&action=logout

  Comportement:
    - Destruction de la session
    - Redirection vers login

EVALUATION DES RESSOURCES (utilisateurs connectes)
--------------------------------------------------
  URL: ?controller=evaluation&action=create&id_ressource=ID

  Fonctionnalites:
    - Formulaire de notation (0 a 5 etoiles, pas de 0.5)
    - Zone de texte pour critique (optionnel, max 1000 car.)
    - Une seule evaluation par utilisateur par ressource
    - Modification possible si deja evalue

  Affichage:
    - Sur la page detail ressource
    - Nom de l'evaluateur
    - Note avec etoiles
    - Texte de la critique
    - Date de l'evaluation

-------------------------------------------------------------------------------
                     FONCTIONNALITES ADMINISTRATION
-------------------------------------------------------------------------------

DASHBOARD ADMIN
---------------
  URL: ?controller=admin&action=index
  Acces: Bibliothecaires et Administrateurs

  Statistiques affichees:
    - Nombre total de ressources
    - Nombre de livres
    - Nombre de films
    - Nombre d'evaluations
    - Nombre de genres
    - Nombre de themes
    - Top 5 des ressources les mieux notees
    - 10 dernieres evaluations (timeline)

GESTION DES LIVRES
------------------
  URLs:
    - Liste      : ?controller=livre&action=index
    - Creation   : ?controller=livre&action=create
    - Soumission : ?controller=livre&action=createPost
    - Edition    : ?controller=livre&action=edit&id=ID
    - Maj        : ?controller=livre&action=editPost
    - Suppression: ?controller=livre&action=delete&id=ID

  Champs du formulaire:
    - Titre (obligatoire, max 255 car.)
    - Auteur (obligatoire, max 255 car.)
    - Annee (obligatoire, 1800-2100)
    - Resume (optionnel, max 5000 car.)
    - URL image (optionnel)
    - Pays (optionnel)
    - ISBN (obligatoire, 13 chiffres, unique)
    - Editeur (optionnel)
    - Nombre de pages (optionnel, 1-10000)
    - Prix (optionnel)
    - Langue (optionnel)
    - Selection des genres (checkboxes)
    - Selection des themes (checkboxes)

GESTION DES FILMS
-----------------
  URLs:
    - Liste      : ?controller=film&action=index
    - Creation   : ?controller=film&action=create
    - Soumission : ?controller=film&action=createPost
    - Edition    : ?controller=film&action=edit&id=ID
    - Maj        : ?controller=film&action=editPost
    - Suppression: ?controller=film&action=delete&id=ID

  Champs du formulaire:
    - Titre (obligatoire)
    - Realisateur (obligatoire)
    - Annee (obligatoire, 1800-2100)
    - Resume (optionnel)
    - URL image (optionnel)
    - Pays (optionnel)
    - Duree en minutes (obligatoire, 1-1000)
    - Support (obligatoire: DVD, Blu-ray ou Streaming)
    - Langue (optionnel)
    - Sous-titres (optionnel)
    - Propose par (optionnel)
    - Casting (optionnel)
    - Selection des genres (checkboxes)
    - Selection des themes (checkboxes)

GESTION DES GENRES
------------------
  URLs:
    - Liste      : ?controller=genre&action=index
    - Creation   : ?controller=genre&action=create
    - Soumission : ?controller=genre&action=createPost
    - Edition    : ?controller=genre&action=edit&id=ID
    - Maj        : ?controller=genre&action=editPost
    - Suppression: ?controller=genre&action=delete&id=ID

  Champs:
    - Nom du genre (obligatoire, unique, max 100 car.)

GESTION DES THEMES
------------------
  URLs:
    - Liste      : ?controller=theme&action=index
    - Creation   : ?controller=theme&action=create
    - Soumission : ?controller=theme&action=createPost
    - Edition    : ?controller=theme&action=edit&id=ID
    - Maj        : ?controller=theme&action=editPost
    - Suppression: ?controller=theme&action=delete&id=ID

  Champs:
    - Nom du theme (obligatoire, unique, max 100 car.)

MODERATION DES EVALUATIONS (Admins uniquement)
----------------------------------------------
  URL: ?controller=admin&action=deleteEvaluation&id=ID
  Acces: Administrateurs uniquement

  Fonctionnalites:
    - Suppression d'evaluations inappropriees
    - Bouton visible sur les avis (page detail ressource)
    - Confirmation avant suppression


================================================================================
                        6. SECURITE IMPLEMENTEE
================================================================================

PROTECTION SQL INJECTION
------------------------
  - Requetes preparees PDO sur toutes les operations
  - Binding des parametres avec types

PROTECTION XSS
--------------
  - htmlspecialchars() sur tous les affichages
  - Encodage ENT_QUOTES

SECURITE MOTS DE PASSE
----------------------
  - Hachage bcrypt via password_hash()
  - Verification via password_verify()
  - Stockage du hash uniquement en BDD

CONTROLE D'ACCES
----------------
  - Sessions PHP securisees
  - Verification du role sur chaque action sensible
  - Middleware Auth::requireAuth() et Auth::requireStaff()
  - Redirection vers login si non authentifie

VALIDATION DES ENTREES
----------------------
  - Validation cote serveur pour tous les formulaires
  - Types de donnees verifies
  - Longueurs maximales respectees
  - Formats specifiques (email, ISBN)
  - Contraintes d'unicite

GESTION DES ERREURS
-------------------
  - Mode d'erreur PDO::EXCEPTION
  - Logs d'erreurs en production
  - Messages d'erreur generiques pour l'utilisateur
  - Detection environnement dev/prod


================================================================================
                        7. INTERFACE UTILISATEUR
================================================================================

DESIGN CSS
----------
  Fichier: public/css/style.css (1200+ lignes)

  Caracteristiques:
    - Variables CSS pour theming
    - Mode clair et mode sombre
    - Design responsive
    - Police: Inter (Google Fonts)
    - Palette: Bleus (#2563eb), Verts, Rouges, Orange

COMPOSANTS VISUELS
------------------
  - Header avec navigation
  - Systeme d'alertes (succes/erreur/info)
  - Badges de type (Livre/Film avec couleurs)
  - Tableaux styles
  - Formulaires avec etats de validation
  - Cartes pour les ressources
  - Affichage des notes en etoiles
  - Grilles responsives

MODE SOMBRE
-----------
  - Toggle dans le header
  - Persistance via localStorage
  - Detection automatique au chargement
  - Transition fluide entre les modes


================================================================================
                        8. DONNEES D'EXEMPLE
================================================================================

LIVRES PRE-CHARGES (5)
----------------------
  1. Dune - Frank Herbert (1965)
  2. 1984 - George Orwell (1949)
  3. Le Petit Prince - Antoine de Saint-Exupery (1943)
  4. Les Miserables - Victor Hugo (1862)
  5. Sapiens - Yuval Noah Harari (2011)

FILMS PRE-CHARGES (5)
---------------------
  1. Inception - Christopher Nolan (2010)
  2. Le Parrain - Francis Ford Coppola (1972)
  3. Interstellar - Christopher Nolan (2014)
  4. Le Roi Lion - Roger Allers (1994)
  5. Matrix - Wachowski (1999)

GENRES PRE-CHARGES (10)
-----------------------
  Science-fiction, Drame, Action, Aventure, Fantastique,
  Thriller, Comedie, Animation, Policier, Historique

THEMES PRE-CHARGES (10)
-----------------------
  Pouvoir, Famille, Amour, Liberte, Guerre,
  Identite, Technologie, Survie, Amitie, Trahison


================================================================================
                        9. CONFIGURATION
================================================================================

FICHIER: config/config.php

ENVIRONNEMENT DEVELOPPEMENT (local)
-----------------------------------
  - Host: localhost:8889 (MAMP)
  - Database: gm401942_elibrary2
  - User: gm401942
  - Password: gm401942

ENVIRONNEMENT PRODUCTION (IUT)
------------------------------
  - Host: linserv-info-01.unice.fr
  - Database: gm401942_elibrary2
  - User: gm401942
  - Password: gm401942

OPTIONS PDO
-----------
  - Mode erreur: EXCEPTION
  - Requetes preparees natives (non emulees)
  - Charset: UTF-8
  - Mode fetch: Tableau associatif


================================================================================
                        10. RESUME DES FONCTIONNALITES
================================================================================

+---------------------------+-------------+---------------+----------------+
|       FONCTIONNALITE      |  PUBLIC     | UTILISATEUR   | STAFF/ADMIN    |
+---------------------------+-------------+---------------+----------------+
| Voir page d'accueil       |     X       |       X       |       X        |
| Parcourir le catalogue    |     X       |       X       |       X        |
| Voir nouveautes           |     X       |       X       |       X        |
| Voir top notes            |     X       |       X       |       X        |
| Recherche avancee         |     X       |       X       |       X        |
| Selection par theme       |     X       |       X       |       X        |
| Detail d'une ressource    |     X       |       X       |       X        |
| S'inscrire                |     X       |       -       |       -        |
| Se connecter              |     X       |       X       |       X        |
| Se deconnecter            |     -       |       X       |       X        |
| Noter une ressource       |     -       |       X       |       X        |
| Ecrire une critique       |     -       |       X       |       X        |
| Voir dashboard admin      |     -       |       -       |       X        |
| Gerer les livres (CRUD)   |     -       |       -       |       X        |
| Gerer les films (CRUD)    |     -       |       -       |       X        |
| Gerer les genres (CRUD)   |     -       |       -       |       X        |
| Gerer les themes (CRUD)   |     -       |       -       |       X        |
| Supprimer evaluations     |     -       |       -       |  ADMIN seul    |
+---------------------------+-------------+---------------+----------------+


================================================================================
                        11. INFORMATIONS PROJET
================================================================================

  Type           : Projet educatif (SAE R307)
  Langage        : PHP (Oriente Objet)
  Base de donnees: MySQL 5.7+
  Framework      : MVC maison
  Architecture   : MVC avec heritage de modeles
  Style de code  : Commentaires et variables en francais
  Serveur prod   : linserv-info-01.unice.fr (IUT Nice)
  Branche Git    : valentin


================================================================================
                              FIN DU RAPPORT
================================================================================
